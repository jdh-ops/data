<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>í”„ë¡œì íŠ¸ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --sidebar-width: 250px; --primary-color: #3498db; }
        body { font-family: 'Malgun Gothic', sans-serif; margin: 0; display: flex; height: 100vh; background: #f4f7f9; }

        /* ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ */
        .sidebar { width: var(--sidebar-width); background: #2c3e50; color: white; display: flex; flex-direction: column; }
        .sidebar-header { padding: 20px; font-size: 1.2rem; font-weight: bold; border-bottom: 1px solid #3e4f5f; text-align: center; }
        .sidebar-menu { flex: 1; padding: 10px 0; }
        .menu-item { padding: 15px 25px; cursor: pointer; transition: 0.3s; display: flex; align-items: center; }
        .menu-item:hover { background: #34495e; }
        .menu-item.active { background: var(--primary-color); }

        /* ë©”ì¸ ì½˜í…ì¸  ìŠ¤íƒ€ì¼ */
        .main-content { flex: 1; overflow-y: auto; padding: 40px; }
        .content-section { display: none; animation: fadeIn 0.3s; }
        .content-section.active { display: block; }

        /* ì—…ë¡œë“œ UI */
        .upload-card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 2px dashed #ddd; text-align: center; }
        .file-list { margin-top: 20px; background: white; border-radius: 12px; overflow: hidden; }
        .file-row { display: flex; justify-content: space-between; padding: 15px; border-bottom: 1px solid #eee; align-items: center; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-header" id="projectTitle">Project</div>
        <div class="sidebar-menu">
            <div class="menu-item active" onclick="showSection('dashboard')">ğŸ  ëŒ€ì‹œë³´ë“œ</div>
            <div class="menu-item" onclick="showSection('upload')">ğŸ“¤ íŒŒì¼ ì—…ë¡œë“œ</div>
            <div class="menu-item" onclick="showSection('settings')">âš™ï¸ ì„¤ì •</div>
        </div>
    </div>

    <div class="main-content">
        <div id="dashboard" class="content-section active">
            <h2>ëŒ€ì‹œë³´ë“œ</h2>
            <p>í”„ë¡œì íŠ¸ì˜ ì „ë°˜ì ì¸ í˜„í™©ì„ í™•ì¸í•©ë‹ˆë‹¤.</p>
        </div>

        <div id="upload" class="content-section">
            <h2>íŒŒì¼ ì—…ë¡œë“œ</h2>
            <div class="upload-card">
                <p>ì—…ë¡œë“œí•  ì—‘ì…€ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.</p>
                <input type="file" id="fileInput" accept=".xlsx, .xls, .csv">
                <button onclick="uploadFile()" style="padding: 10px 20px; background: #3498db; color:white; border:none; border-radius:5px; cursor:pointer;">ì„œë²„ë¡œ ì „ì†¡</button>
                <p id="uploadStatus" style="margin-top:10px; font-size:14px;"></p>
            </div>
            <h3>ì €ì¥ëœ íŒŒì¼ ëª©ë¡</h3>
            <div id="fileList" class="file-list"></div>
        </div>

        <div id="settings" class="content-section">
            <h2>ì„¤ì •</h2>
            <p>ì‹œìŠ¤í…œ í™˜ê²½ì„ ì„¤ì •í•©ë‹ˆë‹¤.</p>
        </div>
    </div>

<script>
    // Supabase ì„¤ì •
    const SUPABASE_URL = 'https://vszejvzjznhmlqddltwt.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZzemVqdnpqem5obWxxZGRsdHd0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY2MjUzMjQsImV4cCI6MjA4MjIwMTMyNH0.O0uFN0J3nMHvlMu1wS4fbumngFTRog6PkHruK6CWE7w'; 
    const _supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const urlParams = new URLSearchParams(window.location.search);
    const tableName = urlParams.get('table') || 'default';
    document.getElementById('projectTitle').innerText = tableName.toUpperCase();

    // 1. ì„¹ì…˜ ì „í™˜ í•¨ìˆ˜
    function showSection(sectionId) {
        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
        
        document.getElementById(sectionId).classList.add('active');
        event.currentTarget.classList.add('active');

        if(sectionId === 'upload') listFiles();
    }

    // 2. íŒŒì¼ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° (Storage ì—°ë™)
    async function listFiles() {
        const { data, error } = await _supabase.storage.from('excel-files').list(tableName + '/');
        const listEl = document.getElementById('fileList');
        if (error || !data) return;

        listEl.innerHTML = data.map(file => {
            const { data: urlData } = _supabase.storage.from('excel-files').getPublicUrl(`${tableName}/${file.name}`);
            return `
                <div class="file-row">
                    <span>${file.name}</span>
                    <a href="${urlData.publicUrl}" target="_blank" style="color:#3498db; text-decoration:none;">ë‹¤ìš´ë¡œë“œ</a>
                </div>
            `;
        }).join('');
    }

    // 3. íŒŒì¼ ì—…ë¡œë“œ í•¨ìˆ˜
    async function uploadFile() {
        const fileInput = document.getElementById('fileInput');
        const status = document.getElementById('uploadStatus');
        if (!fileInput.files[0]) return alert("íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.");

        const file = fileInput.files[0];
        status.innerText = "ì—…ë¡œë“œ ì¤‘...";

        const { error } = await _supabase.storage
            .from('excel-files')
            .upload(`${tableName}/${file.name}`, file, { upsert: true });

        if (error) {
            status.innerText = "âŒ ì‹¤íŒ¨: " + error.message;
        } else {
            status.innerText = "âœ… ì—…ë¡œë“œ ì„±ê³µ!";
            listFiles();
        }
    }

    // ì´ˆê¸° ì‹¤í–‰
    listFiles();
</script>
</body>
</html>

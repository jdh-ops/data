<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>í”„ë¡œì íŠ¸ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --sidebar-width: 250px; --primary-color: #3498db; }
        body { font-family: 'Malgun Gothic', sans-serif; margin: 0; display: flex; height: 100vh; background: #f4f7f9; }

        /* ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ */
        .sidebar { width: var(--sidebar-width); background: #2c3e50; color: white; display: flex; flex-direction: column; }
        .sidebar-header { padding: 20px; font-size: 1.2rem; font-weight: bold; border-bottom: 1px solid #3e4f5f; text-align: center; }
        .sidebar-menu { flex: 1; padding: 10px 0; }
        .menu-item { padding: 15px 25px; cursor: pointer; transition: 0.3s; display: flex; align-items: center; }
        .menu-item:hover { background: #34495e; }
        .menu-item.active { background: var(--primary-color); }

        /* ë©”ì¸ ì½˜í…ì¸  ìŠ¤íƒ€ì¼ */
        .main-content { flex: 1; overflow-y: auto; padding: 40px; }
        .content-section { display: none; animation: fadeIn 0.3s; }
        .content-section.active { display: block; }

        /* ì—…ë¡œë“œ UI */
        .upload-card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 2px dashed #ddd; text-align: center; }
        .file-list { margin-top: 20px; background: white; border-radius: 12px; overflow: hidden; }
        .file-row { display: flex; justify-content: space-between; padding: 15px; border-bottom: 1px solid #eee; align-items: center; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-header" id="projectTitle">Project</div>
        <div class="sidebar-menu">
            <div class="menu-item active" onclick="showSection('dashboard')">ğŸ  ëŒ€ì‹œë³´ë“œ</div>
            <div class="menu-item" onclick="showSection('upload')">ğŸ“¤ íŒŒì¼ ì—…ë¡œë“œ</div>
            <div class="menu-item" onclick="showSection('settings')">âš™ï¸ ì„¤ì •</div>
        </div>
    </div>

    <div class="main-content">
        <div id="dashboard" class="content-section active">
            <h2>ëŒ€ì‹œë³´ë“œ</h2>
            <p>í”„ë¡œì íŠ¸ì˜ ì „ë°˜ì ì¸ í˜„í™©ì„ í™•ì¸í•©ë‹ˆë‹¤.</p>
        </div>

<div id="upload" class="content-section">
    <h2>íŒŒì¼ ì—…ë¡œë“œ</h2>
    
    <div id="dropZone" class="upload-card" 
         ondragover="handleDragOver(event)" 
         ondragleave="handleDragLeave(event)" 
         ondrop="handleDrop(event)">
        <p id="dropText">ğŸ“¤ ì—‘ì…€ íŒŒì¼ì„ ì´ë¦¬ë¡œ ëŒì–´ë‹¤ ë†“ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”.</p>
        <input type="file" id="fileInput" accept=".xlsx, .xls, .csv" style="display: none;" onchange="handleFileSelect(event)">
        <button onclick="document.getElementById('fileInput').click()" class="btn-select">íŒŒì¼ ì„ íƒ</button>
        <p id="selectedFileName" style="margin-top: 10px; font-weight: bold; color: #3498db;"></p>
        <button id="uploadBtn" onclick="uploadFile()" class="btn-primary" style="display: none; margin: 10px auto;">ì„œë²„ë¡œ ì „ì†¡í•˜ê¸°</button>
        <p id="uploadStatus" style="margin-top:10px; font-size:14px;"></p>
    </div>

    <h3>ì €ì¥ëœ íŒŒì¼ ëª©ë¡</h3>
    <div id="fileList" class="file-list"></div>
</div>

<style>
    /* ë“œë˜ê·¸ ì•¤ ë“œë êµ¬ì—­ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
    .upload-card {
        border: 2px dashed #ccc;
        background: #fff;
        transition: all 0.3s ease;
        padding: 40px;
        cursor: pointer;
    }
    .upload-card.drag-over {
        border-color: #3498db;
        background: #ebf5fb;
        transform: scale(1.02);
    }
    .btn-select {
        padding: 8px 16px;
        background: #eee;
        border: 1px solid #ddd;
        border-radius: 4px;
        cursor: pointer;
    }
    .btn-primary {
        padding: 12px 24px;
        background: #3498db;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
    }
</style>

<script>
    let selectedFile = null;

    // ë“œë˜ê·¸ ì‹œ íš¨ê³¼
    function handleDragOver(e) {
        e.preventDefault();
        document.getElementById('dropZone').classList.add('drag-over');
    }

    function handleDragLeave(e) {
        e.preventDefault();
        document.getElementById('dropZone').classList.remove('drag-over');
    }

    // íŒŒì¼ì„ ë†“ì•˜ì„ ë•Œ
    function handleDrop(e) {
        e.preventDefault();
        document.getElementById('dropZone').classList.remove('drag-over');
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            processFile(files[0]);
        }
    }

    // í´ë¦­í•´ì„œ íŒŒì¼ì„ ì„ íƒí–ˆì„ ë•Œ
    function handleFileSelect(e) {
        const files = e.target.files;
        if (files.length > 0) {
            processFile(files[0]);
        }
    }

    // ì„ íƒëœ íŒŒì¼ ì²˜ë¦¬ ë° í™”ë©´ í‘œì‹œ
    function processFile(file) {
        selectedFile = file;
        document.getElementById('selectedFileName').innerText = "ì„ íƒëœ íŒŒì¼: " + file.name;
        document.getElementById('uploadBtn').style.display = 'block'; // ì „ì†¡ ë²„íŠ¼ ë³´ì´ê¸°
        document.getElementById('dropText').innerText = "íŒŒì¼ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!";
    }

    // íŒŒì¼ ì—…ë¡œë“œ í•¨ìˆ˜ (ê¸°ì¡´ ë¡œì§ í™œìš©)
    async function uploadFile() {
        if (!selectedFile) return alert("íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.");
        
        const status = document.getElementById('uploadStatus');
        status.innerText = "ì„œë²„ë¡œ ì „ì†¡ ì¤‘...";

        const { error } = await _supabase.storage
            .from('excel-files')
            .upload(`${tableName}/${selectedFile.name}`, selectedFile, { upsert: true });

        if (error) {
            status.innerText = "âŒ ì‹¤íŒ¨: " + error.message;
        } else {
            status.innerText = "âœ… ì—…ë¡œë“œ ì„±ê³µ!";
            selectedFile = null;
            document.getElementById('selectedFileName').innerText = "";
            document.getElementById('uploadBtn').style.display = 'none';
            document.getElementById('dropText').innerText = "ğŸ“¤ ì—‘ì…€ íŒŒì¼ì„ ì´ë¦¬ë¡œ ëŒì–´ë‹¤ ë†“ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”.";
            listFiles();
        }
    }
</script>
</body>
</html>
